@import url("https://fonts.googleapis.com/css2?family=Roboto:ital,wght@1,300&display=swap");

/* =========================================
   Cascade Layers Order
   ========================================= */
@layer reset, base, components;

/* =========================================
   Reset
   ========================================= */
@layer reset {
    * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
    }
}

/* =========================================
   Base
   ========================================= */
@layer base {
    :root {
        /* Colors */
        --color-bg: #bbb;
        --color-white: whitesmoke;
        --color-black: #000;
        --border-dark: #333;
        --label-bg: rgb(231, 226, 199);
        --shadow-ring: rgba(225, 225, 225, 0.2);
        --glare-strong: rgba(255, 255, 255, 0.1);
        --glare-weak: rgba(255, 255, 255, 0.05);
        --metal-1: #bbb;
        --metal-2: #ccc;
        --metal-3: #999;

        /* Sizing (Baerwald-based, scalable) */
        /* Scale: pixels per millimeter (tweak to resize whole scene) */
        --mm: 1px;

        /* Physical recorded groove band (IEC) */
        --inner-record-mm: 60.3;
        --outer-record-mm: 146.1;

        /* Record diameter = 2 * outer null radius */
        --record-diameter-mm: calc(2 * var(--outer-record-mm));
        --record-size: calc(var(--record-diameter-mm) * var(--mm));

        /* Platter slightly larger than record */
        --platter-overhang-mm: 2;
        --platter-size: calc((var(--record-diameter-mm) + (2 * var(--platter-overhang-mm))) * var(--mm));
        --platter-radius: calc(var(--platter-size) / 2);

        /* Label derived from inner recorded radius minus allowances */
        --record-clearance-mm: 9;
        --label-radius-mm: calc(var(--inner-record-mm) - var(--record-clearance-mm));
        --label-diameter-mm: calc(2 * var(--label-radius-mm));
        /* ≈ 102.6 mm */
        --label-size: calc(var(--label-diameter-mm) * var(--mm));

        /* Spindle hole ~7.2mm */
        --spindle-diameter-mm: 7.2;
        --spindle-size: calc(var(--spindle-diameter-mm) * var(--mm));

        /* Arm and cartridge sizes (mm-based) */
        --arm-base-mm: 50;
        --arm-base-size: calc(var(--arm-base-mm) * var(--mm));
        --arm-bar-width-mm: 8;
        --arm-bar-width: calc(var(--arm-bar-width-mm) * var(--mm));
        /* Effective tonearm length (pivot center to stylus tip) in mm */
        --eff-length-mm: 232.8;
        /* Mounting distance (pivot-to-spindle) in mm */
        --pivot-to-spindle-mm: 215;
        --mount-distance: calc(var(--pivot-to-spindle-mm) * var(--mm));
        /* Mount angle control (degrees). */
        --mount-angle: 30deg;
        /* Direction from platter center to pivot, computed at runtime */
        --mount-cos: calc(cos(var(--mount-angle)));
        --mount-sin: calc(-1 * sin(var(--mount-angle)));
        /* Arm bar visual length, matched to effective length at the current scale. If your stylus graphic extends
              beyond the bar end, subtract that offset in mm from this value. */
        --arm-bar-length: calc(var(--eff-length-mm) * var(--mm));
        --arm-lower-length-mm: 75;
        --arm-lower-length: calc(var(--arm-lower-length-mm) * var(--mm));

        /* Cartridge styling */
        --cart-width-mm: 16;
        --cart-height-mm: 26;
        --cart-radius-mm: 2;
        --cart-width: calc(var(--cart-width-mm) * var(--mm));
        --cart-height: calc(var(--cart-height-mm) * var(--mm));
        --cart-radius: calc(var(--cart-radius-mm) * var(--mm));
        --cart-color-1: #1e1e1e;
        --cart-color-2: #0f0f0f;
        --cart-accent: #d0d0d0;
        --stylus-length-mm: 10;
        --stylus-length: calc(var(--stylus-length-mm) * var(--mm));
        --stylus-angle: 23.7deg;

        /* Label ring visual thicknesses (mm-based cosmetic) */
        --label-ring-1-mm: 15;
        --label-ring-2-mm: 17;
        --label-ring-3-mm: 19;
        --label-ring-4-mm: 21;

        /* Pivot cap visuals */
        --pivot-cap-size-mm: 42;
        --pivot-cap-offset-mm: 4;

        /* Animation timings */
        --spin-duration: 1s;
        --teeter-duration: 1.3333333333s;
        --move-duration: 50s;
        --move-init-duration: 1s;
        --spin-delay: 2s;
        --move-init-delay: 1s;
        --move-delay: 2s;

        /* Arm rotation derived from geometry (0deg = downwards).
              Start near right-down: 90deg - (mount angle + acos((d^2 + L^2 - R_outer^2) / 2dL))
              End further clockwise: 90deg - (mount angle + acos((d^2 + L^2 - R_inner^2) / 2dL))
          */
        --arm-rotate-start: calc(90deg - (var(--mount-angle) + acos(((var(--pivot-to-spindle-mm) * var(--pivot-to-spindle-mm)) + (var(--eff-length-mm) * var(--eff-length-mm)) - (var(--outer-record-mm) * var(--outer-record-mm))) / (2 * var(--pivot-to-spindle-mm) * var(--eff-length-mm)))));
        --arm-rotate-end: calc(90deg - (var(--mount-angle) + acos(((var(--pivot-to-spindle-mm) * var(--pivot-to-spindle-mm)) + (var(--eff-length-mm) * var(--eff-length-mm)) - (var(--inner-record-mm) * var(--inner-record-mm))) / (2 * var(--pivot-to-spindle-mm) * var(--eff-length-mm)))));
    }

    body {
        height: 100svh;
        background: var(--color-bg);
        overflow: clip;
    }

    /* Visually hidden, still accessible */
    .sr-only {
        position: absolute !important;
        height: 1px;
        width: 1px;
        overflow: hidden;
        clip: rect(1px, 1px, 1px, 1px);
        white-space: nowrap;
        clip-path: inset(50%);
        border: 0;
        padding: 0;
        margin: -1px;
    }

    /* Play/Pause toggle button */
    .play-toggle {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 10;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 8px 12px;
        border-radius: 999px;
        font: 500 14px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        cursor: pointer;
        user-select: none;
    }

    .play-toggle__text {
        display: inline-block;
    }

    .play-toggle__text.pause {
        display: none;
    }

    /* Checked state shows Pause */
    #play-toggle:checked+.play-toggle .play-toggle__text.play {
        display: none;
    }

    #play-toggle:checked+.play-toggle .play-toggle__text.pause {
        display: inline-block;
    }
}

/* =========================================
   Components: Record Player (block)
   ========================================= */
@layer components {
    .record-player {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        /* Give the container a size so percentage positioning is reliable */
        width: var(--platter-size);
        height: var(--platter-size);
    }

    .record-player__platter {
        background-color: var(--color-white);
        width: var(--platter-size);
        aspect-ratio: 1;
        border-radius: 50%;
        /* center the platter relative to the .record-player anchor */
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: grid;
        justify-items: center;
        align-items: center;
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.5);
    }

    .record-player__record {
        /* exact record size derived from Baerwald nulls and scale */
        width: var(--record-size);
        aspect-ratio: 1;
        border-radius: 50%;
        background: var(--color-black);
        /* position relative inside the platter so transforms originate at center */
        position: relative;
        display: grid;
        justify-items: center;
        align-items: center;
        background-image: radial-gradient(circle at center,
                transparent 32.75%,
                rgba(255, 255, 255, 0.05) 33%,
                rgba(255, 255, 255, 0.05) 38%,
                transparent 38.25%,
                transparent 38.75%,
                rgba(255, 255, 255, 0.05) 39%,
                rgba(255, 255, 255, 0.05) 48%,
                transparent 48.25%,
                transparent 48.75%,
                rgba(255, 255, 255, 0.05) 49%,
                rgba(255, 255, 255, 0.05) 57%,
                transparent 57.25%,
                transparent 57.75%,
                rgba(255, 255, 255, 0.05) 58%,
                rgba(255, 255, 255, 0.05) 62%,
                transparent 62.25%,
                transparent 62.75%,
                rgba(255, 255, 255, 0.05) 63%,
                rgba(255, 255, 255, 0.05) 69%,
                transparent 69.25%);
        overflow: clip;
    }

    .record-player__record::before {
        content: "";
        position: absolute;
        background-color: var(--color-bg);
        box-shadow: 0 0 5px black;
        width: var(--spindle-size);
        aspect-ratio: 1;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        z-index: 1;
    }

    .record-player__label {
        background: var(--label-bg);
        width: var(--label-size);
        aspect-ratio: 1;
        border-radius: 50%;
        position: absolute;
        /* center the label within the record */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        box-shadow:
            0 0 0 calc(var(--label-ring-1-mm) * var(--mm)) var(--shadow-ring),
            0 0 0 calc(var(--label-ring-2-mm) * var(--mm)) var(--color-black),
            0 0 0 calc(var(--label-ring-3-mm) * var(--mm)) var(--shadow-ring),
            0 0 0 calc(var(--label-ring-4-mm) * var(--mm)) var(--color-black);
        border: 4px solid var(--border-dark);
        display: grid;
        align-items: center;
        justify-content: center;
    }

    .record-player__label::after {
        content: "CHEN.XING";
        color: black;
        font-family: "Roboto", sans-serif;
        font-weight: 300;
        font-style: italic;
        font-size: 0.7rem;
        width: 100%;
        height: 100%;
        text-align: center;
        padding-top: 20px;
    }

    /* Glare overlay */
    .record-player__glare {
        height: 100%;
        width: 100%;
        filter: blur(2vh);
        /* softens the glare edges */
        pointer-events: none;
        /* non-interactive decorative layer */
        user-select: none;
        /* anchor glare to platter center */
        position: absolute;
        top: 0;
        left: 0;
    }

    /* Glare shapes simulate reflection */
    .record-player__glare::before {
        content: "";
        height: 100%;
        width: 100%;
        position: absolute;
        background-color: var(--glare-strong);
        clip-path: polygon(100% 0, 100% 50%, 0 50%, 0 100%);
        /* a soft diagonal glare */
    }

    .record-player__glare::after {
        content: "";
        height: 100%;
        width: 100%;
        position: absolute;
        background-color: var(--glare-weak);
        clip-path: polygon(0 0, 50% 0, 50% 100%, 100% 100%);
        /* a softer diagonal glare */
    }

    /* Tonearm pivot */
    .record-player__pivot {
        width: var(--arm-base-size);
        height: var(--arm-base-size);
        /* subtle metal look and shadow for depth */
        background-image: linear-gradient(180deg, #ddd, #bfbfbf);
        border-radius: 50%;
        position: absolute;
        /* position pivot from platter center by mounting distance to the right */
        top: 50%;
        left: 50%;
        /* center the pivot circle on its origin, then offset by mount distance at 45° to top-right */
        translate: calc(var(--mount-distance) * var(--mount-cos) - 50%) calc(var(--mount-distance) * var(--mount-sin) - 50%);
        /* uses independent transform longhand to compose with transform animations */
        display: grid;
        justify-content: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
    }

    .record-player__pivot::before {
        /* visual pivot cap */
        content: "";
        width: calc(var(--pivot-cap-size-mm) * var(--mm));
        height: calc(var(--pivot-cap-size-mm) * var(--mm));
        background: rgb(197, 196, 196);
        border-radius: 50%;
        position: absolute;
        top: calc(var(--pivot-cap-offset-mm) * var(--mm));
        left: calc(var(--pivot-cap-offset-mm) * var(--mm));
    }

    /* Main arm element that extends from the pivot */
    .record-player__arm {
        position: absolute;
        left: 50%;
        height: var(--arm-bar-length);
        width: var(--arm-bar-width);
        background-image: linear-gradient(to right, var(--metal-1), var(--metal-2) 40%, var(--metal-3));
        transform: translateX(-50%);
        transform-origin: top center;
        filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.5));
    }

    .record-player__arm::before {
        /* decorative shoulder on the arm */
        content: "";
        position: absolute;
        width: calc(15 * var(--mm));
        height: calc(30 * var(--mm));
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        clip-path: polygon(0% 50%, 25% 100%, 75% 100%, 100% 50%, 100% 0, 0 0);
        background-image: linear-gradient(to bottom, transparent 45%, rgba(255, 255, 255, 0.025) 55%), linear-gradient(to right, #222, #111);
    }

    .record-player__cartridge {
        content: "";
        display: block;
        position: absolute;
        /* center the cartridge horizontally at arm tip */
        left: 50%;
        transform: translateX(-50%) rotate(var(--stylus-angle));
        transform-origin: top center;
        /* place directly below the arm end */
        width: var(--cart-width);
        height: var(--cart-height);
        bottom: calc(-1 * var(--cart-height));
        border-radius: var(--cart-radius);
        /* slightly tapered front with beveled shoulders */
        clip-path: polygon(8% 0%, 92% 0%, 100% 35%, 100% 100%, 0 100%, 0 35%);
        background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.06) 0 40%, rgba(0, 0, 0, 0.12) 60% 100%),
            linear-gradient(to right, var(--cart-color-1), var(--cart-color-2));
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
        pointer-events: none;
    }

    /* CSS-only control: animations are present but paused by default so the
       checkbox can toggle animation-play-state. */

    .record-player .record-player__record {
        /* record continuously spins but starts paused */
        animation: spin var(--spin-duration) infinite linear var(--spin-delay);
        animation-play-state: paused;
        transform-origin: 50% 50%;
    }

    .record-player .record-player__glare::before {
        animation: teeter var(--teeter-duration) linear infinite;
        animation-play-state: paused;
        transform-origin: 50% 50%;
    }

    .record-player .record-player__glare::after {
        animation: teeter-flip var(--teeter-duration) linear infinite;
        animation-play-state: paused;
        transform-origin: 50% 50%;
    }

    .record-player .record-player__pivot {
        /* run an initial move then long move; both start paused */
        animation: move-init var(--move-init-duration) 1 forwards var(--move-init-delay), move var(--move-duration) infinite linear var(--move-delay);
        animation-play-state: paused, paused;
        transform-origin: 50% 50%;
    }

    /* When checked, set all related animations to running (play) */
    #play-toggle:checked~main .record-player .record-player__record,
    #play-toggle:checked~main .record-player .record-player__glare::before,
    #play-toggle:checked~main .record-player .record-player__glare::after,
    #play-toggle:checked~main .record-player .record-player__pivot {
        animation-play-state: running !important;
    }
}

/* =========================================
   Accessibility: Reduced Motion
   ========================================= */
@media (prefers-reduced-motion: reduce) {
    @layer components {

        .record-player__record,
        .record-player__label {
            animation: none !important;
        }

        .record-player__glare {
            filter: none;
        }

        .record-player__glare::before,
        .record-player__glare::after {
            animation: none !important;
        }

        .record-player__pivot {
            animation: none !important;
        }
    }
}

/* =========================================
   Animations
   ========================================= */
@keyframes spin {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

/* a small positive rotation to simulate teetering */
@keyframes teeter {
    0% {
        transform: rotate(0deg);
    }

    35% {
        transform: rotate(2.5deg);
    }

    100% {
        transform: rotate(0deg);
    }
}

/* a small negative rotation to simulate teetering */
@keyframes teeter-flip {
    0% {
        transform: rotate(0deg);
    }

    35% {
        transform: rotate(-2.5deg);
    }

    100% {
        transform: rotate(0deg);
    }
}

@keyframes move-init {
    from {
        rotate: 0deg;
    }

    to {
        rotate: var(--arm-rotate-start);
    }
}

@keyframes move {

    0%,
    100% {
        rotate: var(--arm-rotate-start);
    }

    97% {
        rotate: var(--arm-rotate-end);
    }
}